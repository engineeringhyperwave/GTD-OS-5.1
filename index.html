<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTD OS v5.3 - Large Text Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary: #2563eb; }
        .stuck-project { border-left: 8px solid #ef4444 !important; }
        .tab-active { color: var(--primary); border-right: 5px solid var(--primary); background: #eff6ff; font-weight: bold; }
        /* æ ‡ç­¾å­—å·æ”¾å¤§ */
        .area-tag { background: #f1f5f9; color: #475569; font-size: 12px; padding: 4px 10px; border-radius: 6px; font-weight: 800; text-transform: uppercase; }
        /* å…¨å±€åŸºç¡€å­—å·æ”¾å¤§ */
        body { font-family: 'Inter', system-ui, sans-serif; font-size: 16px; }
    </style>
</head>
<body class="bg-slate-50 flex h-screen overflow-hidden text-slate-900">

<!-- ä¾§è¾¹æ  -->
<aside class="w-80 border-r bg-white flex flex-col h-full flex-shrink-0">
    <div class="p-8"><h1 class="text-3xl font-black tracking-tighter text-blue-600 italic">GTD OS 5.3</h1></div>
    <div class="px-6 mb-6">
        <input type="text" id="globalSearch" oninput="render()" placeholder="ğŸ” æœç´¢æ‰€æœ‰ç»´åº¦..." class="w-full bg-slate-100 border-none rounded-xl p-3 text-sm outline-none">
    </div>
    <nav class="flex-1 overflow-y-auto px-4 space-y-2">
        <button onclick="setFilter('status','inbox')" id="btn-inbox" class="w-full text-left px-4 py-3 rounded-xl transition flex justify-between text-base font-medium">ğŸ“¥ æ”¶ä»¶ç®± <span id="badge-inbox" class="text-blue-600 font-bold"></span></button>
        <button onclick="setFilter('status','projects')" id="btn-projects" class="w-full text-left px-4 py-3 rounded-xl transition flex justify-between text-base font-medium">ğŸ“¦ é¡¹ç›® (10k') <span id="badge-stuck"></span></button>
        <button onclick="setFilter('status','next')" id="btn-next" class="w-full text-left px-4 py-3 rounded-xl transition text-base font-medium">ğŸš€ ä¸‹ä¸€æ­¥ (Ground)</button>
        <button onclick="setFilter('status','waiting')" id="btn-waiting" class="w-full text-left px-4 py-3 rounded-xl transition text-base font-medium">â³ ç­‰å¾…æ¸…å•</button>
        <button onclick="setFilter('status','someday')" id="btn-someday" class="w-full text-left px-4 py-3 rounded-xl transition text-base font-medium">ğŸ’¤ ä¹Ÿè®¸/å­µåŒ–</button>
        
        <div class="text-xs font-bold text-slate-400 uppercase tracking-widest px-4 mt-8 mb-2">æ‰§è¡Œæƒ…å¢ƒ (Contexts)</div>
        <div id="context-list" class="space-y-1"></div>
    </nav>
    <div class="p-6 border-t text-center">
        <button onclick="exportData()" class="text-sm text-slate-400 hover:text-blue-600 font-bold tracking-wide">ğŸ’¾ å¯¼å‡º JSON å¤‡ä»½æ•°æ®</button>
    </div>
</aside>

<!-- ä¸»åŒº -->
<main class="flex-1 flex flex-col h-full">
    <header class="h-24 bg-white border-b flex items-center px-10 gap-6">
        <input type="text" id="quickInput" placeholder="åœ¨æ­¤æ•æ‰ä½ çš„æƒ³æ³•... æŒ‰ Enter å­˜å…¥æ”¶ä»¶ç®±" class="flex-1 text-2xl border-none outline-none font-medium placeholder:text-slate-300">
        <button onclick="alert('æ¯å‘¨å›é¡¾å»ºè®®ï¼š\n1. æ¸…ç©ºæ”¶ä»¶ç®±\n2. æ£€æŸ¥é¡¹ç›®æ˜¯å¦éƒ½æœ‰ä¸‹ä¸€æ­¥åŠ¨ä½œ\n3. å®¡è§†ä¹Ÿè®¸æ¸…å•')" class="text-sm bg-blue-600 text-white px-6 py-3 rounded-full font-bold shadow-lg shadow-blue-100 hover:bg-blue-700 transition">é«˜ç©ºå®¡è§†</button>
    </header>
    <section id="listView" class="flex-1 overflow-y-auto p-10 space-y-6 bg-slate-50/50"></section>
</main>

<!-- ç¼–è¾‘/ç†æ¸…æ¨¡æ€æ¡† -->
<div id="editModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[300] flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-2xl rounded-[2rem] shadow-2xl overflow-hidden animate-in fade-in zoom-in duration-200">
        <div class="p-10">
            <textarea id="editTitle" class="w-full text-2xl font-bold border-none focus:ring-0 p-0 mb-6 resize-none outline-none text-slate-800" rows="2" placeholder="äº‹åŠ¡åç§°"></textarea>
            
            <!-- é¡¹ç›®ä¸“æœ‰çš„ Why å’Œ Area -->
            <div id="projectMeta" class="mb-8 p-6 bg-blue-50 rounded-2xl space-y-4 hidden border border-blue-100">
                <div>
                    <label class="text-xs font-bold text-blue-500 uppercase tracking-wider mb-1 block">Why? (é¡¹ç›®ç›®çš„/æˆåŠŸæ„¿æ™¯)</label>
                    <input type="text" id="editPurpose" placeholder="å®Œæˆåä¼šæ˜¯ä»€ä¹ˆæ ·ï¼Ÿä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ" class="w-full bg-transparent border-b border-blue-200 py-2 outline-none text-blue-900 italic text-lg">
                </div>
                <div>
                    <label class="text-xs font-bold text-blue-500 uppercase tracking-wider mb-1 block">Area (æ‰€å±äººç”Ÿé¢†åŸŸ)</label>
                    <input type="text" id="editArea" placeholder="å¦‚ï¼šèŒä¸šæˆé•¿, å¥åº·, å®¶åº­..." class="w-full bg-transparent border-b border-blue-200 py-2 outline-none font-bold text-lg">
                </div>
            </div>

            <!-- æ ¸å¿ƒï¼šç†æ¸…è·¯å¾„çš„å››ä¸ªå¤§æŒ‰é’® -->
            <label class="text-xs font-bold text-slate-400 uppercase tracking-widest block mb-4">ç†æ¸…è¿™ä¸ªäº‹åŠ¡çš„å»å‘ï¼š</label>
            <div class="grid grid-cols-2 gap-4 mb-8">
                <button onclick="updateStatus('next')" class="p-5 border-2 border-slate-100 rounded-2xl hover:border-blue-500 hover:bg-blue-50 text-left transition group">
                    <span class="block font-bold text-blue-700 text-lg">ğŸš€ ä¸‹ä¸€æ­¥</span>
                    <span class="text-xs text-slate-500 mt-1 block leading-relaxed">æ ‡è®°ä¸ºç«‹åˆ»å¯ä»¥æ‰§è¡Œçš„å…·ä½“åŠ¨ä½œã€‚</span>
                </button>
                <button onclick="updateStatus('projects')" class="p-5 border-2 border-slate-100 rounded-2xl hover:border-purple-500 hover:bg-purple-50 text-left transition">
                    <span class="block font-bold text-purple-700 text-lg">ğŸ“¦ å‡æ ¼ä¸ºé¡¹ç›®</span>
                    <span class="text-xs text-slate-500 mt-1 block leading-relaxed">å¦‚æœè¿™ä»¶äº‹éœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆï¼Œå°†å…¶å‡æ ¼ä¸ºé¡¹ç›®ã€‚</span>
                </button>
                <button onclick="updateStatus('waiting')" class="p-5 border-2 border-slate-100 rounded-2xl hover:border-amber-500 hover:bg-amber-50 text-left transition">
                    <span class="block font-bold text-amber-600 text-lg">â³ ç­‰å¾…æ¸…å•</span>
                    <span class="text-xs text-slate-500 mt-1 block leading-relaxed">è¿™ä»¶äº‹äº¤ç»™äº†åˆ«äººå¤„ç†ï¼Œæˆ–è€…åœ¨ç­‰å¾…æŸä¸ªç»“æœã€‚</span>
                </button>
                <button onclick="updateStatus('someday')" class="p-5 border-2 border-slate-100 rounded-2xl hover:border-slate-400 hover:bg-slate-100 text-left transition">
                    <span class="block font-bold text-slate-600 text-lg">ğŸ’¤ ä¹Ÿè®¸/å­µåŒ–</span>
                    <span class="text-xs text-slate-500 mt-1 block leading-relaxed">ç°åœ¨ä¸åšï¼Œæœªæ¥å¯èƒ½åšã€‚</span>
                </button>
            </div>

            <div class="flex gap-6">
                <div class="flex-1">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block">Context (@æƒ…å¢ƒ)</label>
                    <input type="text" id="editContext" placeholder="ä¾‹å¦‚ï¼š@ç”µè„‘, @åŠå…¬å®¤..." class="w-full bg-slate-50 rounded-xl p-3 outline-none border border-slate-100 focus:border-blue-400 text-base">
                </div>
                <div class="flex-1" id="parentSelectBox">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block">Parent Project (æ‰€å±é¡¹ç›®)</label>
                    <select id="editParent" class="w-full bg-slate-50 rounded-xl p-3 outline-none border border-slate-100 focus:border-blue-400 text-base"></select>
                </div>
            </div>
        </div>
        <div class="bg-slate-50 px-10 py-6 flex justify-between items-center border-t">
            <button onclick="deleteItem()" class="text-red-500 text-sm hover:text-red-700 font-bold uppercase tracking-wider">ğŸ—‘ï¸ å½»åº•åˆ é™¤</button>
            <button onclick="saveChanges()" class="bg-slate-900 text-white px-10 py-3 rounded-2xl text-base font-bold hover:bg-black transition shadow-xl">å®Œæˆç†æ¸…</button>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('gtd_v52_data')) || { items: [], contexts: [] };
    let filter = { type: 'status', value: 'inbox' };
    let editingId = null;

    function save() { localStorage.setItem('gtd_v52_data', JSON.stringify(db)); render(); }

    function render() {
        const view = document.getElementById('listView');
        const query = document.getElementById('globalSearch').value.toLowerCase();
        let list = db.items.filter(i => !i.done && i.text.toLowerCase().includes(query));

        // ä¾§è¾¹æ é«˜äº®
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('tab-active'));
        const btn = document.getElementById('btn-' + filter.value) || document.getElementById('btn-ctx-' + filter.value);
        if(btn) btn.classList.add('tab-active');

        // æ›´æ–° Context åˆ—è¡¨
        document.getElementById('context-list').innerHTML = db.contexts.map(c => `
            <button onclick="setFilter('context','${c}')" id="btn-ctx-${c}" class="w-full text-left px-4 py-2 text-sm text-slate-500 hover:bg-slate-100 rounded-xl transition font-medium">${c}</button>
        `).join('');

        let display = (filter.type === 'status') ? list.filter(i => i.status === filter.value) : list.filter(i => i.context === filter.value);

        if(filter.value === 'projects') {
            view.innerHTML = display.map(p => {
                const subs = db.items.filter(i => i.parentId === p.id && !i.done);
                return `
                    <div class="bg-white p-8 rounded-[2rem] shadow-sm border-2 ${subs.length === 0 ? 'stuck-project' : 'border-transparent'} transition hover:shadow-xl relative group">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="text-2xl font-black text-slate-800">${p.text}</h3>
                                    ${p.area ? `<span class="area-tag">${p.area}</span>` : ''}
                                </div>
                                ${p.purpose ? `<p class="text-sm text-blue-500 italic font-medium">ç›®æ ‡: ${p.purpose}</p>` : ''}
                            </div>
                            <button onclick="openEdit(${p.id})" class="text-xs bg-slate-100 px-3 py-1.5 rounded-lg text-slate-400 hover:text-blue-600 font-bold uppercase transition">ç¼–è¾‘é¡¹ç›®å±æ€§</button>
                        </div>
                        <div class="space-y-3 border-t pt-6">
                            ${subs.map(s => `<div class="text-base text-slate-600 flex items-center gap-3 font-medium">
                                <span class="text-blue-400 font-bold">â†³</span> ${s.text}
                            </div>`).join('')}
                            <button onclick="quickAction(${p.id})" class="text-blue-600 text-sm font-black mt-4 px-4 py-2 bg-blue-50 rounded-xl hover:bg-blue-100 transition inline-block">+ æ‹†è§£ä¸‹ä¸€æ­¥è¡ŒåŠ¨</button>
                        </div>
                    </div>
                `;
            }).join('');
        } else {
            view.innerHTML = display.length === 0 ? `<div class="text-center py-24 text-slate-300 italic text-xl">æ¸…å•ç©ºç©ºå¦‚ä¹Ÿï¼Œå¿ƒå¦‚æ­¢æ°´ã€‚</div>` : 
                display.map(i => `
                    <div class="bg-white p-6 rounded-2xl shadow-sm flex items-center justify-between group hover:shadow-lg transition-all border border-transparent hover:border-blue-100">
                        <div class="flex items-center gap-6">
                            <input type="checkbox" onchange="completeItem(${i.id})" class="w-7 h-7 rounded-full border-slate-300 text-blue-600 focus:ring-0 cursor-pointer">
                            <div>
                                <div class="text-xl font-bold text-slate-700">${i.text}</div>
                                <div class="flex gap-3 mt-2">
                                    ${i.context ? `<span class="text-xs font-black text-blue-500 bg-blue-50 px-2 py-0.5 rounded uppercase">${i.context}</span>` : ''}
                                    ${i.parentId ? `<span class="text-xs font-black text-purple-400 bg-purple-50 px-2 py-0.5 rounded uppercase">ğŸ“Œ ${db.items.find(p=>p.id===i.parentId)?.text}</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <button onclick="openEdit(${i.id})" class="opacity-0 group-hover:opacity-100 bg-slate-100 p-3 rounded-xl text-slate-400 hover:text-blue-600 transition-all text-xl">âš™ï¸</button>
                    </div>
                `).join('');
        }
        document.getElementById('badge-inbox').innerText = db.items.filter(i => i.status === 'inbox' && !i.done).length || '';
        const stuck = db.items.filter(i => i.status === 'projects' && !i.done && !db.items.some(a => a.parentId === i.id && !a.done)).length;
        document.getElementById('badge-stuck').innerText = stuck ? `ğŸ›‘ ${stuck}ä¸ªåœæ»` : '';
    }

    function openEdit(id) {
        editingId = id;
        const item = db.items.find(i => i.id === id);
        document.getElementById('editTitle').value = item.text;
        document.getElementById('editContext').value = item.context || "";
        document.getElementById('editPurpose').value = item.purpose || "";
        document.getElementById('editArea').value = item.area || "";
        
        document.getElementById('projectMeta').classList.toggle('hidden', item.status !== 'projects');
        document.getElementById('parentSelectBox').classList.toggle('hidden', item.status === 'projects');

        const sel = document.getElementById('editParent');
        sel.innerHTML = '<option value="">None (ç‹¬ç«‹è¡ŒåŠ¨)</option>' + db.items.filter(i => i.status === 'projects' && !i.done && i.id !== id).map(p => 
            `<option value="${p.id}" ${item.parentId === p.id ? 'selected' : ''}>${p.text}</option>`).join('');
        
        document.getElementById('editModal').classList.remove('hidden');
    }

    function saveChanges() {
        const item = db.items.find(i => i.id === editingId);
        if(!item) return;
        item.text = document.getElementById('editTitle').value;
        item.context = document.getElementById('editContext').value;
        item.purpose = document.getElementById('editPurpose').value;
        item.area = document.getElementById('editArea').value;
        item.parentId = parseInt(document.getElementById('editParent').value) || null;
        if(item.context && !db.contexts.includes(item.context)) db.contexts.push(item.context);
        closeModal(); save();
    }

    function updateStatus(status) {
        const item = db.items.find(i => i.id === editingId);
        item.status = status;
        saveChanges();
    }

    function setFilter(t, v) { filter = { type: t, value: v }; render(); }
    function completeItem(id) { 
        const item = db.items.find(i => i.id === id);
        if(item) {
            item.done = true; 
            // å¦‚æœæ˜¯é¡¹ç›®å®Œæˆï¼Œä¸ä¸€å®šä»£è¡¨å­ä»»åŠ¡å®Œæˆï¼Œä½†GTDé€»è¾‘é€šå¸¸å»ºè®®å…ˆæ¸…ç©ºå­ä»»åŠ¡
            save(); 
        }
    }
    function closeModal() { document.getElementById('editModal').classList.add('hidden'); }
    function deleteItem() { if(confirm('ç¡®å®šè¦æ°¸ä¹…åˆ é™¤è¿™ä¸ªäº‹åŠ¡å—ï¼Ÿ')) { db.items = db.items.filter(i => i.id !== editingId); closeModal(); save(); } }
    function quickAction(pid) { const t = prompt("ä¸‹ä¸€æ­¥å…·ä½“è¦åšä»€ä¹ˆï¼Ÿ"); if(t) { db.items.push({ id: Date.now(), text: t, status: 'next', parentId: pid, done: false }); save(); } }
    function exportData() { const blob = new Blob([JSON.stringify(db)], {type: 'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `GTD_Backup_${new Date().toLocaleDateString()}.json`; a.click(); }

    document.getElementById('quickInput').addEventListener('keypress', (e) => {
        if(e.key === 'Enter' && e.target.value) {
            db.items.push({ id: Date.now(), text: e.target.value, status: 'inbox', done: false });
            e.target.value = ''; save();
        }
    });

    render();
</script>
</body>
</html>